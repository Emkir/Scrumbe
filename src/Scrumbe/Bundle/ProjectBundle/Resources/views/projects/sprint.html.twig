{% extends "ScrumbeProjectBundle:Layout:layout-app.html.twig" %}

{% block title %}Sprint{% endblock %}

{% block nav %}
    <nav class="nav-projects">
        <ul class="left-nav">
            <li class="logo">
                <a href="">
                    <img src="/assets/img/logo.svg" alt="search icon">
                </a>
            </li>
            <li><a href="{{ url('scrumbe_get_projects') }}">{{ "nav.projects" | trans() }}</a></li>
            <li><a href="">{{ "nav.learn" | trans() }}</a></li>
            <li>
                <a href="">
                    <img src="/assets/img/icons/search-icon.svg" alt="search icon">
                </a>
            </li>
        </ul>
        <ul class="right-nav">
            <li>
                <img src="/assets/img/icons/help-icon.svg" alt="help icon"/>
            </li>
            <li>
                <div class="notif-ctn">
                    <img src="/assets/img/icons/notification-icon.svg" alt="notification icon"/>
                    <span class="notif-count">2</span>
                </div>
            </li>
            <li>
                <div class="avatar-ctn">
                    <img src="/assets/img/Claude-Guglieri.png" alt="avatar">
                </div>
                <img src="/assets/img/icons/arrow-down-icon.svg" alt="arrown-down icon">
            </li>
        </ul>
    </nav>
    <div class="sub-nav-projects">
        <span class="title">{{ project.name }}</span>
        <div class="divider"></div>
        <ul class="sub-nav">
            <li class="active">
                <a href="{{ path('scrumbe_get_sprint', {'projectId':project.id, 'projectName':project.url_name}) }}">{{ "nav.project.sprint" | trans() }}</a>
            </li>
            <li>
                <a href="{{ path('scrumbe_get_project', {'projectId':project.id, 'projectName':project.url_name}) }}">{{ 'nav.project.kanban' | trans() }}</a>
            </li>
            <li>
                <a href="{{ path('scrumbe_get_backlog', {'projectId':project.id, 'projectName':project.url_name}) }}">{{ "nav.project.backlog" | trans() }}</a>
            </li>
            <li>
                <a href="{{ path('team') }}">{{ "nav.project.team" | trans() }}</a>
            </li>
        </ul>
        <a href="" class="add-sprint">
            <img src="/assets/img/icons/add-project-icon.svg" alt="add project icon">
        </a>
    </div>
{% endblock %}

{% block body %}
    <section class="sprint">
        <ul class="sprints-list">
            {% for sprint in project.sprints %}
                <li>
                    <div class="infos-ctn">
                        <span class="state {{ sprint.state }}"></span>
                        <h2>{{ sprint.name }}</h2>
                        <ul class="member-list">
                            <li>
                                <div class="avatar-ctn">
                                    <img src="/assets/img/Claude-Guglieri.png" alt=""/>
                                </div>
                            </li>
                            <li>
                                <div class="avatar-ctn">
                                    <img src="/assets/img/Thomas-Sanson.png" alt=""/>
                                </div>
                            </li>
                            <li>
                                <div class="avatar-ctn">
                                    <img src="/assets/img/Anthony-Ribeiro.png" alt=""/>
                                </div>
                            </li>
                            <li>
                                <div class="avatar-ctn">
                                    <img src="/assets/img/Christophe-Tauziet.png" alt=""/>
                                </div>
                            </li>
                        </ul>
                        <div class="task-count">
                            <canvas id="gauge"></canvas>
                            <span class="tasks">{{ sprint.done_tasks }}/{{ sprint.total_tasks }}</span>
                        </div>
                    </div>
                    <div class="date-ctn">
                        <span class="start-date">{{sprint.start_date.date| localizeddate('medium', 'none')}}</span>
                        <img src="/assets/img/arrow.png" alt="arrow"/>
                        <span class="end-date">{{sprint.end_date.date| localizeddate('medium', 'none')}}</span>
                    </div>
                </li>
            {% endfor %}
            <li class="form-sprint">
                <form action="">
                    <div class="infos-ctn">
                        <input type="text" placeholder="Nom de l'itération" class="title"/>
                        <select name="" multiple class="us-list">
                            <option value="1">US1</option>
                            <option value="2">US2</option>
                            <option value="3">US3</option>
                            <option value="4">US4</option>
                        </select>
                        <input type="text" placeholder="Date de début" class="start-date-input"/>
                        <img src="/assets/img/arrow.png" alt="arrow"/>
                        <input type="text" placeholder="Date de fin" class="start-end-input"/>
                        <span class="submit">Valider</span>
                    </div>
                </form>
            </li>
        </ul>
    </section>
{% endblock %}

{% block script %}
    <script src="/assets/js/libs/gauge.min.js"></script>
    <script src="/assets/js/libs/selectize.min.js"></script>
    <script src="/assets/js/libs/jquery.datetimepicker.js"></script>
    <script>
        // Gauge.js
        var opts = {
            lines: 12,
            angle: 0.5,
            lineWidth: 0.05,
            pointer: {
                length: 1,
                strokeWidth: 0.035,
                color: '#28CEE0'
            },
            limitMax: 'false',
            colorStart: '#28CEE0',
            colorStop: '#28CEE0',
            strokeColor: '#E6EAEE',
            generateGradient: true
        };
        var target = document.getElementById('gauge');
        var gauge = new Donut(target).setOptions(opts);
        gauge.maxValue = 100;
        gauge.set(90);
        gauge.animationSpeed = 32;

        // Add Sprint
        $('.add-sprint').click(function(){

        });

        // List US Selectize.js
        $('.us-list').selectize();

        // Initiate Datetime picker
        $('.start-date-input').datetimepicker({
            lang:'fr',
            timepicker:false,
            format:'d/m/Y'
        });
        $('.start-end-input').datetimepicker({
            lang:'fr',
            timepicker:false,
            format:'d/m/Y'
        });

        // Send new sprint
        $('submit').click(function(){
            var title = $('.title').val();
            var startDate = $('.start-date-input').val();
            var endDate = $('.start-end-input').val();
            var us = $('.us-list').val();

            $.ajax({
                url: '',
                method: 'PUT',
                data: {
                    'title': title,
                    'us': us,
                    'startDate': startDate,
                    'endDate': endDate
                }
            }).done(function(data){
                console.log(data)
            }).fail(function(data){
                console.log(data)
            })
        })
    </script>
{% endblock %}